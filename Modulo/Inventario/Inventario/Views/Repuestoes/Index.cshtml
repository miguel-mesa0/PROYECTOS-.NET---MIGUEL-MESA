@model IEnumerable<Inventario.Models.Inventario.RepuestoListadoViewModel>

@{
    ViewData["Title"] = "Repuestos";
}

<div class="flex justify-between items-center mb-6">
    <div>
        <h1 class="text-2xl font-bold text-slate-800">Repuestos</h1>
        <p class="text-sm text-slate-500">
            Catálogo de repuestos con márgenes, costos y stock total por todas las bodegas.
        </p>
    </div>

    <a asp-action="Create"
       class="inline-flex items-center px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold shadow">
        <i class="fa-solid fa-plus mr-2"></i> Nuevo repuesto
    </a>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="mb-4 px-4 py-3 rounded-lg bg-emerald-100 text-emerald-800 text-sm">
        @TempData["SuccessMessage"]
    </div>
}

<div class="bg-white rounded-xl shadow overflow-hidden">
    <table class="min-w-full text-xs md:text-sm">
        <thead class="bg-slate-100 border-b border-slate-200">
            <tr>
                <th class="px-3 py-2 text-left font-semibold text-slate-600 uppercase">Código</th>
                <th class="px-3 py-2 text-left font-semibold text-slate-600 uppercase">Nombre</th>
                <th class="px-3 py-2 text-left font-semibold text-slate-600 uppercase">Categoría</th>
                <th class="px-3 py-2 text-right font-semibold text-slate-600 uppercase">Costo prom.</th>
                <th class="px-3 py-2 text-right font-semibold text-slate-600 uppercase">Margen %</th>
                <th class="px-3 py-2 text-right font-semibold text-slate-600 uppercase">Desc. %</th>
                <th class="px-3 py-2 text-center font-semibold text-slate-600 uppercase">Activo</th>
                <th class="px-3 py-2 text-right font-semibold text-slate-600 uppercase">Stock mín.</th>
                <th class="px-3 py-2 text-right font-semibold text-slate-600 uppercase">Stock</th>
                <th class="px-3 py-2 text-right font-semibold text-slate-600 uppercase">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="10" class="px-4 py-6 text-center text-slate-400">
                        No hay repuestos registrados.
                    </td>
                </tr>
            }
            else
            {
                foreach (var r in Model)
                {
                    var stockBajo = r.StockTotal <= r.StockMinimoGlobal;

                    <tr class="border-b border-slate-100 hover:bg-slate-50">
                        <td class="px-3 py-2 align-middle text-slate-800 font-semibold">@r.Codigo</td>
                        <td class="px-3 py-2 align-middle text-slate-800">@r.Nombre</td>
                        <td class="px-3 py-2 align-middle text-slate-700">@r.CategoriaNombre</td>
                        <td class="px-3 py-2 align-middle text-right text-slate-800">
                            $ @r.PrecioCostoPromedio.ToString("N2")
                        </td>
                        <td class="px-3 py-2 align-middle text-right text-slate-700">
                            @r.MargenGananciaPorcentaje.ToString("N2") %
                        </td>
                        <td class="px-3 py-2 align-middle text-right text-slate-700">
                            @(r.DescuentoPorcentaje?.ToString("N2") ?? "0,00") %
                        </td>
                        <td class="px-3 py-2 align-middle text-center">
                            @if (r.Activo)
                            {
                                <span class="inline-flex px-2 py-1 rounded-full text-[11px] bg-emerald-100 text-emerald-700">
                                    Activo
                                </span>
                            }
                            else
                            {
                                <span class="inline-flex px-2 py-1 rounded-full text-[11px] bg-red-100 text-red-700">
                                    Inactivo
                                </span>
                            }
                        </td>
                        <td class="px-3 py-2 align-middle text-right text-slate-700">
                            @r.StockMinimoGlobal
                        </td>
                        <td class="px-3 py-2 align-middle text-right">
                            <span class="inline-flex px-2 py-1 rounded-full text-[11px] font-semibold
                                                 @(stockBajo ? "bg-red-100 text-red-700" : "bg-emerald-100 text-emerald-700")">
                                @r.StockTotal
                            </span>
                        </td>
                        <td class="px-3 py-2 align-middle text-right space-x-1">
                            <a asp-action="Details" asp-route-id="@r.Id"
                               class="inline-flex items-center px-2 py-1 text-[11px] rounded bg-slate-200 hover:bg-slate-300 text-slate-800">
                                <i class="fa-solid fa-eye mr-1"></i> Ver
                            </a>
                            <a asp-action="Edit" asp-route-id="@r.Id"
                               class="inline-flex items-center px-2 py-1 text-[11px] rounded bg-blue-500 hover:bg-blue-600 text-white">
                                <i class="fa-solid fa-pen mr-1"></i> Editar
                            </a>
                            <a asp-action="Delete" asp-route-id="@r.Id"
                               class="inline-flex items-center px-2 py-1 text-[11px] rounded bg-red-500 hover:bg-red-600 text-white">
                                <i class="fa-solid fa-trash mr-1"></i> Eliminar
                            </a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
